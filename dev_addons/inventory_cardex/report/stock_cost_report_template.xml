<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Plantilla para el reporte PDF -->
    <template id="report_stock_cost_document">
        <t t-call="web.external_layout">
            <t t-foreach="docs" t-as="doc">
                <div class="page">
                    <main>
                    <!-- Encabezado del reporte -->
                    <div class="row mb-4">
                        <div class="col-12 text-center">
                            <h2 style="color: #2C3E50; border-bottom: 3px solid #3498DB; padding-bottom: 10px;">
                                REPORTE DE COSTOS DE INVENTARIO
                            </h2>
                        </div>
                    </div>

                    <!-- Informacion del periodo -->
                    <div class="row mb-3">
                        <div class="col-6">
                            <p><strong>Periodo:</strong> 
                                <t t-esc="doc.date_from"/> - 
                                <t t-esc="doc.date_to"/>
                            </p>
                        </div>
                        <div class="col-6 text-right">
                            <p><strong>Generado:</strong> 
                                <t t-esc="datetime.datetime.now()"/>
                            </p>
                        </div>
                    </div>

                    <!-- Obtener datos del reporte -->
                    <t t-set="data" t-value="doc._get_report_data()"/>

                    <!-- Resumen ejecutivo -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div style="background-color: #ECF0F1; padding: 15px; border-radius: 5px;">
                                <h4 style="color: #2C3E50; margin-top: 0;">Resumen Ejecutivo</h4>
                                <div class="row">
                                    <div class="col-4">
                                        <strong>Total de Movimientos:</strong> 
                                        <t t-esc="len(data.get('moves', []))"/>
                                    </div>
                                    <div class="col-4">
                                        <strong>Cantidad Total:</strong> 
                                        <t t-esc="data.get('total_quantity', 0)"/>
                                    </div>
                                    <div class="col-4">
                                        <strong>Valor Total:</strong> 
                                        <span style="color: #27AE60; font-weight: bold;">
                                            <t t-esc="data.get('total_cost', 0)"/>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tabla de movimientos -->
                    <table class="table table-sm table-bordered" style="margin-top: 20px;">
                        <thead style="background-color: #3498DB; color: white;">
                            <tr>
                                <th class="text-center">ID</th>
                                <th class="text-center">Fecha</th>
                                <th>Referencia</th>
                                <th>Producto</th>
                                <th class="text-right">Cantidad</th>
                                <th class="text-right">Costo Unit.</th>
                                <th class="text-right">Costo Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="data.get('moves', [])" t-as="move">
                                <tr>
                                    <td class="text-center">
                                        <t t-esc="move.id"/>
                                    </td>
                                    <td class="text-center">
                                        <t t-esc="move.date"/>
                                    </td>
                                    <td>
                                        <t t-esc="move.name"/>
                                    </td>
                                    <td>
                                        <t t-esc="move.product_id.display_name"/>
                                    </td>
                                    <td class="text-right">
                                        <t t-esc="move.product_qty"/>
                                    </td>
                                    <td class="text-right">
                                        <t t-esc="move.product_cost"/>
                                    </td>
                                    <td class="text-right" style="font-weight: bold;">
                                        <t t-esc="move.product_cost * move.product_qty"/>
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                        <tfoot style="background-color: #ECF0F1; font-weight: bold;">
                            <tr>
                                <td colspan="4" class="text-right">TOTALES:</td>
                                <td class="text-right">
                                    <t t-esc="data.get('total_quantity', 0)"/>
                                </td>
                                <td></td>
                                <td class="text-right" style="color: #27AE60; font-size: 16px;">
                                    <t t-esc="data.get('total_cost', 0)"/>
                                </td>
                            </tr>
                        </tfoot>
                    </table>

                    <!-- Pie de pagina con notas -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <p style="font-size: 10px; color: #7F8C8D;">
                                <strong>Nota:</strong> Este reporte incluye unicamente movimientos en estado 'Hecho'. 
                                Los costos reflejan el valor almacenado en la base de datos al momento de la generacion del reporte.
                            </p>
                        </div>
                    </div>
                    </main>
                </div>
            </t>
        </t>
    </template>

    <!-- Definicion del reporte -->
    <record id="action_report_stock_cost" model="ir.actions.report">
        <field name="name">Reporte de Costos de Inventario</field>
        <field name="model">stock.cost.report.wizard</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">inventory_cardex.report_stock_cost_document</field>
        <field name="report_file">inventory_cardex.report_stock_cost_document</field>
        <field name="binding_model_id" ref="model_stock_cost_report_wizard"/>
        <field name="binding_type">report</field>
        <field name="print_report_name">'Reporte_Costos_%s_%s' % (object.date_from, object.date_to)</field>
    </record>

</odoo>
